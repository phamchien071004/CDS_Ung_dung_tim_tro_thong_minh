<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tr·ª£ l√Ω g·ª£i √Ω ph√≤ng tr·ªç</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <header>
      <h1>üè† Tr·ª£ l√Ω g·ª£i √Ω ph√≤ng tr·ªç sinh vi√™n</h1>
      <p>Nh·∫≠p y√™u c·∫ßu ƒë·ªÉ AI g·ª£i √Ω ph√≤ng tr·ªç ph√π h·ª£p nh·∫•t</p>
    </header>

    <main>
      <div class="chat-box" id="chatBox">
        <div class="bot-message">
          üëã Xin ch√†o! M√¨nh l√† tr·ª£ l√Ω AI. H√£y cho m√¨nh bi·∫øt y√™u c·∫ßu ph√≤ng tr·ªç c·ªßa b·∫°n nh√©.
        </div>
      </div>

      <div class="input-area">
        <textarea id="question" placeholder="V√≠ d·ª•: T√¥i mu·ªën t√¨m ph√≤ng tr·ªç ·ªü H√† N·ªôi gi√° kho·∫£ng 2 tri·ªáu..."></textarea>
        <button id="sendBtn">G·ª≠i</button>
      </div>
    </main>
  </div>

  <script>
    const sendBtn = document.getElementById("sendBtn");
    const chatBox = document.getElementById("chatBox");
    const questionInput = document.getElementById("question");

    sendBtn.addEventListener("click", askAI);

    async function askAI() {
      const question = questionInput.value.trim();
      if (!question) return;

      appendMessage(question, "user");
      questionInput.value = "";

      appendMessage("‚è≥ ƒêang x·ª≠ l√Ω...", "bot");

      try {
        const res = await fetch("http://localhost:3000/api/ask", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ question }),
        });

        const data = await res.json();
        const lastBotMsg = chatBox.querySelector(".bot-message:last-child");
        lastBotMsg.remove();

        if (data.answer.length === 0) {
          appendMessage("‚ùå Kh√¥ng t√¨m th·∫•y ph√≤ng ph√π h·ª£p.", "bot");
        } else {
          data.answer.forEach(room => appendRoomCard(room));
        }
      } catch (err) {
        appendMessage("üö´ L·ªói k·∫øt n·ªëi t·ªõi server.", "bot");
        console.error(err);
      }
    }

    function appendMessage(content, sender) {
      const msg = document.createElement("div");
      msg.classList.add(sender === "user" ? "user-message" : "bot-message");
      msg.textContent = content;
      chatBox.appendChild(msg);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    function appendRoomCard(room) {
      const card = document.createElement("div");
      card.classList.add("bot-message", "room-card");

      const img = document.createElement("img");
      img.src = room.image || "https://via.placeholder.com/150";
      card.appendChild(img);

      const info = document.createElement("div");
      info.classList.add("room-info");

      const name = document.createElement("h3");
      name.textContent = `${room.name} - ${room.price.toLocaleString()} VND`;
      info.appendChild(name);

      const district = document.createElement("p");
      district.textContent = `Khu v·ª±c: ${room.district}`;
      info.appendChild(district);

      const amenities = document.createElement("p");
      amenities.textContent = `Ti·ªán nghi: ${room.amenities.join(", ")}`;
      info.appendChild(amenities);

      const desc = document.createElement("p");
      desc.textContent = `M√¥ t·∫£: ${room.desc}`;
      info.appendChild(desc);

      card.appendChild(info);
      chatBox.appendChild(card);
      chatBox.scrollTop = chatBox.scrollHeight;
    }
  </script>
</body>
</html>
